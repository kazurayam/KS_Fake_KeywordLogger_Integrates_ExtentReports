:ReposURLPrefix: https://kazurayam.github.io/KS_Fake_KeywordLogger_Integrates_ExtentReports

= A fake KeywordLogger could integrate Extent Reports into Katalon project nicely

link:{ReposURLPrefix}/[The repository]

== Problem to solve

I want to create a test execution report of a Katalon Studio project using the https://extentreports.com/[Extent Reports]. Let me give you an sample problem.

I made a Test Suite `TS1`:

image:{ReposURLPrefix}/images/TS1.png[]

Also I made 2 Test Cases. The `TC1` is as follows:

[source,groovy]
----
include::../Scripts/TC1/Script1740559328725.groovy[]
----

And `TC2` is as follows:

[source,groovy]
----
include::../Scripts/TC2/Script1740576074455.groovy[]
----

When I exected the `TS1`, Katalon Studio generated an HTML report like this:

image:{ReposURLPrefix}/images/TS1_builtin_report.png[]

Every Katalon users will find there is nothing special in TS1, TC1, TC2 and the HTML report. It's a boring stuff.

Now I want to add another format of test execution report generated by https://extentreports.com/[Extent Reports]. The report looks something like this:

image:{ReposURLPrefix}/images/TS1_ExtentReports.png[]

Now I would set a constraint to myself in achieving the Extent Reports integration into Katalon project.

**The Test Case `TC1` should not be changed. It should remain the same as before. Test Cases shouldn't make any call to the Extent Reports API. The ordinary `WebUI.comment(String message)` should print the message into a new report generated by Extent Reports as well.**

How can I achieve it?

== Solution

We can read the source code of `com.kms.katalon.core.**` packages contained in the Katalon Studio distributables. For example, on my Mac, I could find the jar files that contain the sources :

[source,text]
----
$ pwd
/Applications/Katalon Studio.app/Contents/Eclipse/configuration/resources/source
$ tree -P *.jar
.
├── com.kms.katalon.core
│   └── com.kms.katalon.core-sources.jar
├── com.kms.katalon.core.cucumber
│   └── com.kms.katalon.core.cucumber-sources.jar
├── com.kms.katalon.core.mobile
│   └── com.kms.katalon.core.mobile-sources.jar
├── com.kms.katalon.core.testng
│   └── com.kms.katalon.core.testng-sources.jar
├── com.kms.katalon.core.webservice
│   └── com.kms.katalon.core.webservice-sources.jar
├── com.kms.katalon.core.webui
│   └── com.kms.katalon.core.webui-sources.jar
└── com.kms.katalon.core.windows
    └── com.kms.katalon.core.windows-sources.jar

8 directories, 7 files
----

I started reading the source codes to find out how a call `WebUI.comment("雨ニモマケズ")` propagates through the call chains and how the message is written into the Console tab and the HTML report file located at `Reports/yyyyMMdd_hhmmss/TS1/yyyyMMdd_hhmmss/execution0.log` file. Eventurally I found it. Let me trace the path that I went through.

:ReposURLPrefix: https://github.com/kazurayam/KS_Fake_KeywordLogger_Integrates_ExtentReports

:SourceURLPrefix: {ReposURLPrefix}/blob/main/docs/katalon-studio-source/10.0.0/source

:src_WebUiBuiltInKeywords: {SourceURLPrefix}/com.kms.katalon.core.webui/com/kms/katalon/core/webui/keyword/WebUiBuiltInKeywords.groovy

:src_BuiltInKeywords: {SourceURLPrefix}/com.kms.katalon.core/com/kms/katalon/core/keyword/BuiltinKeywords.groovy

:src_KeywordExecutor: {SourceURLPrefix}/com.kms.katalon.core/com/kms/katalon/core/keyword/internal/KeywordExecutor.groovy

:src_CommentKeyword: {SourceURLPrefix}/com.kms.katalon.core/com/kms/katalon/core/keyword/builtin/CommentKeyword.groovy

:src_AbstractKeyword: {SourceURLPrefix}/com.kms.katalon.core/com/kms/katalon/core/keyword/internal/AbstractKeyword.groovy

:src_KeywordLogger: {SourceURLPrefix}/docs/katalon-studio-source/10.0.0/source/com.kms.katalon.core/com/kms/katalon/core/logging/KeywordLogger.java


- A call to `WebUI.comment("雨ニモマケズ")` in a Test Case script effectively calls the `comment()` method of the `com.kms.katalon.core.webui.keyword.WebUiBuiltInKeywords` class but you can not find the metthod in the link:{src_WebUiBuiltInKeywords}[source]. The `comment()` method is actually implemented in the link:{src_BuiltInKeywords}[`com.kms.katalon.core.keyword.BuiltInKeywords`].

- The `comment()` method of link:{src_BuiltInKeywords}[`com.kms.katalon.core.keyword.BuiltInKeyword`] calls the `executeKeywordForPlatform()` method of the link:{src_KeywordExecutor}[`com.kms.katalon.core.keyword.internal.KeywordExecutor`].

- A call to `KeywordExecutor.executeKeywordForPlatform(KeywordExecutor.PLATFORM_BUILT_IN, "comment", message)` effectively calls `comment(String message)` of the {src_CommentKeyword}[`com.kms.katalon.core.keyword.builtin.CommentKeyword`]. The method is implemented as follows:
[source, groovy]
----
include::./katalon-studio-source/10.0.0/source/com.kms.katalon.core/com/kms/katalon/core/keyword/builtin/CommentKeyword.groovy[lines=27..30]
----

- The variable named `logger` is declared in the link:{src_AbstractKeyword}[`com.kms.katalon.core.keyword.internal.AbstractKeyword`], which is the parent class of the `CommentKeyword` class, as follows:
[source,groovy]
----
...
import com.kms.katalon.core.logging.KeywordLogger
...
public abstract class AbstractKeyword implements IKeyword {

    protected final KeywordLogger logger = KeywordLogger.getInstance(this.getClass());

    ...
----

- The `logInfo(String)` method of link:{src_KeywordLogger}[`com.kms.katalon.core.logging.KeywordLogger`] is implemented as follows:
[source,java]
----
include::katalon-studio-source/10.0.0/source/com.kms.katalon.core/com/kms/katalon/core/logging/KeywordLogger.java[lines=394..397]
----

Finally, I got to the heart of the matter! The `logInfo(String)` method of the link:{src_KeywordLogger}[`com.kms.katalon.core.logging.KeywordLogger`] object actually prints messages into
1. the LogViewer in the Katalon Studio GUI, and
2. the `execution0.log` file under the `<projectDir>/Reports` directory. Katalon Studio will later transform the file into the builtin test execution reports in HTML/CSV/PDF.

So, I want to change the `logInfo(String)` method of the `KeywordLogger` so that the message is also transferred into a report generated by Extent Reports. In short I want to change it as:

[source,groovy]
----
	public void logInfo(String message, Map<String, String> attributes) {
		logger.info(message);
		xmlKeywordLogger.logInfo(this, message, attributes);
		// println "[fake KeywordLogger#logInfo] ${message}"
		ReportBuilderKzImpl.getInstance().logInfo(message)  // transfer msg into Extent Reports
	}
----

Straight-forward, isn't it?

== Difficulty

How can I actually change the `logInfo` method of `com.kms.katalon.core.logging.KeywordLogger` object?

Katalon Studio is not an open-source software. It is a propriatory software product of Katalon who exclusively owns the source code, though a copy of source code is published.

After a few days of studies, I (@kazurayam) have found out a hack. Let me tell you about it in the following section.

== Bad Hack


== Description

== Conclusion


