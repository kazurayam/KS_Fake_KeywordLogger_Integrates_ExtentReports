:PagesURLPrefix: https://kazurayam.github.io/KS_Fake_KeywordLogger_Integrates_ExtentReports

:ReposURLPrefix: https://github.com/kazurayam/KS_Fake_KeywordLogger_Integrates_ExtentReports


= A fake KeywordLogger could integrate Extent Reports into Katalon project nicely

link:{ReposURLPrefix}/[The repository]

== Problem to solve

I want to create a test execution report of a Katalon Studio project using the https://extentreports.com/[Extent Reports]. Let me give you an sample problem.

I made a Test Suite `TS1`:

image:{PagesURLPrefix}/images/TS1.png[]

Also I made 2 Test Cases. The `TC1` is as follows:

[source,groovy]
----
include::../Scripts/main/TC1/Script1740559328725.groovy[]
----

And `TC2` is as follows:

[source,groovy]
----
include::../Scripts/main/TC2/Script1740576074455.groovy[]
----

When I exected the `TS1`, Katalon Studio generated an HTML report like this:

image:{PagesURLPrefix}/images/TS1_builtin_report.png[]

Every Katalon users will find there is nothing special in TS1, TC1, TC2 and the HTML report. It's a boring stuff.

Now I want to add another format of test execution report generated by https://extentreports.com/[Extent Reports]. The report looks something like this:

image:{PagesURLPrefix}/images/TS1_ExtentReports.png[]

Now I would set a constraint to myself in achieving the Extent Reports integration into Katalon project.

**The Test Case `TC1` should not be changed. It should remain the same as before. Test Cases shouldn't make any call to the Extent Reports API. The ordinary `WebUI.comment(String message)` should print the message into a new report generated by Extent Reports as well.**

How can I achieve it?

== Solution

We can read the source code of `com.kms.katalon.core.**` packages contained in the Katalon Studio distributables. For example, on my Mac, I could find the jar files that contain the sources :

[source,text]
----
$ pwd
/Applications/Katalon Studio.app/Contents/Eclipse/configuration/resources/source
$ tree -P *.jar
.
├── com.kms.katalon.core
│   └── com.kms.katalon.core-sources.jar
├── com.kms.katalon.core.cucumber
│   └── com.kms.katalon.core.cucumber-sources.jar
├── com.kms.katalon.core.mobile
│   └── com.kms.katalon.core.mobile-sources.jar
├── com.kms.katalon.core.testng
│   └── com.kms.katalon.core.testng-sources.jar
├── com.kms.katalon.core.webservice
│   └── com.kms.katalon.core.webservice-sources.jar
├── com.kms.katalon.core.webui
│   └── com.kms.katalon.core.webui-sources.jar
└── com.kms.katalon.core.windows
    └── com.kms.katalon.core.windows-sources.jar

8 directories, 7 files
----

I started reading the source codes to find out how a call `WebUI.comment("雨ニモマケズ")` propagates through the call chains and how the message is written into the Console tab and the HTML report file located at `Reports/yyyyMMdd_hhmmss/TS1/yyyyMMdd_hhmmss/execution0.log` file. Eventurally I found it. Let me trace the path that I went through.


:SourceURLPrefix: {ReposURLPrefix}/blob/main/docs/katalon-studio-source/10.0.0/source

:src_WebUiBuiltInKeywords: {SourceURLPrefix}/com.kms.katalon.core.webui/com/kms/katalon/core/webui/keyword/WebUiBuiltInKeywords.groovy

:src_BuiltInKeywords: {SourceURLPrefix}/com.kms.katalon.core/com/kms/katalon/core/keyword/BuiltinKeywords.groovy

:src_KeywordExecutor: {SourceURLPrefix}/com.kms.katalon.core/com/kms/katalon/core/keyword/internal/KeywordExecutor.groovy

:src_CommentKeyword: {SourceURLPrefix}/com.kms.katalon.core/com/kms/katalon/core/keyword/builtin/CommentKeyword.groovy

:src_AbstractKeyword: {SourceURLPrefix}/com.kms.katalon.core/com/kms/katalon/core/keyword/internal/AbstractKeyword.groovy

:src_KeywordLogger: {SourceURLPrefix}/com.kms.katalon.core/com/kms/katalon/core/logging/KeywordLogger.java

- A call to `WebUI.comment("雨ニモマケズ")` in a Test Case script calls the `comment()` method of the `com.kms.katalon.core.webui.keyword.WebUiBuiltInKeywords` class but you can not find the method in the link:{src_WebUiBuiltInKeywords}[source]. The `comment()` method is actually implemented in the link:{src_BuiltInKeywords}[`com.kms.katalon.core.keyword.BuiltInKeywords`] which is the parent class.

- The `comment()` method of link:{src_BuiltInKeywords}[`com.kms.katalon.core.keyword.BuiltInKeyword`] calls the `executeKeywordForPlatform()` method of the link:{src_KeywordExecutor}[`com.kms.katalon.core.keyword.internal.KeywordExecutor`].

- A call to `KeywordExecutor.executeKeywordForPlatform(KeywordExecutor.PLATFORM_BUILT_IN, "comment", message)` calls `comment(String message)` of the {src_CommentKeyword}[`com.kms.katalon.core.keyword.builtin.CommentKeyword`]. The method is implemented as follows:
[source, groovy]
----
include::./katalon-studio-source/10.0.0/source/com.kms.katalon.core/com/kms/katalon/core/keyword/builtin/CommentKeyword.groovy[lines=27..30]
----

- The variable named `logger` is declared in the link:{src_AbstractKeyword}[`com.kms.katalon.core.keyword.internal.AbstractKeyword`], which is the parent class of the `CommentKeyword` class, as follows:
[source,groovy]
----
...
import com.kms.katalon.core.logging.KeywordLogger
...
public abstract class AbstractKeyword implements IKeyword {

    protected final KeywordLogger logger = KeywordLogger.getInstance(this.getClass());

    ...
----

- The `logInfo(String)` method of link:{src_KeywordLogger}[`com.kms.katalon.core.logging.KeywordLogger`] is implemented as follows:
[source,java]
----
include::katalon-studio-source/10.0.0/source/com.kms.katalon.core/com/kms/katalon/core/logging/KeywordLogger.java[lines=394..397]
----

Finally, I got to the heart of the matter! The `logInfo(String)` method of the link:{src_KeywordLogger}[`com.kms.katalon.core.logging.KeywordLogger`] object actually prints messages into
1. the LogViewer in the Katalon Studio GUI, and
2. the `execution0.log` file under the `<projectDir>/Reports` directory. Katalon Studio will later transform the file into the builtin test execution reports in HTML/CSV/PDF.

So, I want to change the `logInfo` method of the `KeywordLogger` so that the message is also transferred into a report generated by Extent Reports. In short I want to change it as:

[source,groovy]
----
include::../Include/scripts/groovy/com/kms/katalon/core/logging/KeywordLogger.groovy[lines=416..429]
----

Simple, isn't it?

== Difficulty

How can I actually change the `logInfo` method of `com.kms.katalon.core.logging.KeywordLogger` object?

Katalon Studio is not an open-source software. It is a proprietary software product of Katalon who exclusively owns the source code; though a set of copy is published.

== Bad Hack

After a few weeks of studies, I @kazurayam have found out a hack. Let me tell you about it here.

Every Katalon Studio project has a file named `.classpath` where all libraries available to the project are listed. It starts with the following lines:

image::{PagesURLPrefix}/images/classpath.png[]

The line#8 declares the `/Applications/Katalon Studio.app/Contents/Eclipse/plugins/com.kms.katalon.core_1.0.0.202501201829.jar`. This jar contains the binary of the link:{src_KeywordLogger}[`com.kms.katalon.core.logging.KeywordLogger`]. And a line above the `<classpathentry kind="src" output="bin/groovy" path="Include/scripts/groovy"/>` is declared. As you know, Katalon Studio allows you to create any custom Groovy class in the `<projectDir>/Include/scripts/groovy` folder. The classes created in the `Include/scripts/groovy` folder is declared first. The precedence depends on the line order. Therefore the classes in the `Include/scripts/groovy` folder will have the higher precedence to the classes in the `com.kms.katalon.core_1.0.0.202501201829.jar`.

Now, I can create a fake `com.kms.katalon.core.logging.KeywordLogger` in the `Include/scripts/groovy`. Katalon Studio will allow me to do it.

image::{PagesURLPrefix}/images/Fake_KeywordLogger.png[]

Then what will happen? --- My fake `KeywordLogger` will have higher precedence to the real `KeywordLogger` provided by Katalon. Effectively I can change the source code of the `KeywordLogger` as I like.

I created this project and tried this idea. It worked!

== Description

I created this project and tried my idea: "A fake KeywordLogger integrates Extent Reports into Katalo project". It worked!

=== How to resolve external dependencies

I need to import several external dependencies such as Extent Reports, etc into my project. I used the link:https://github.com/katalon-studio/katalon-gradle-plugin[Katalon Studio's Gradle Plugin].

I created a link:{ReposURLPrefix}/blob/main/build.gradle[build.gradle] file.

In the command line, I ran:

[source]
----
$ pwd
~/katalon-workspace/KS_Fake_KeywordLogger_Integrates_ExtentReports
$ gradle katalonCopyDependencies
...
----

Then a few jar files will be downloaded from the Maven Central repository in to the `Drivers` folder, as follows:

image::{PagesURLPrefix}/images/Drivers.png[]

=== Codes created

:blobmainPrefix: {ReposURLPrefix}/blob/develop

:path_KeywordLogger: Include/scripts/groovy/com/kms/katalon/core/logging/KeywordLogger.groovy

:path_ReportBuilder: Include/scripts/groovy/com/kazurayam/ks/reporting/ReportBuilder.groovy

:path_ReportBuilderExtentImpl: Include/scripts/groovy/com/kazurayam/ks/reporting/ReportBuilderExtentImpl.groovy

:path_ReportBuildersLoader: Include/scripts/groovy/com/kazurayam/ks/reporting/ReportBuildersLoader.groovy

:path_config: reportbuilders.config.json

:path_Listener: Test%20Listeners/CustomReportsListener.groovy

:path_TC1: Scripts/main/TC1/Script1740559328725.groovy

:path_TC2: Scripts/main/TC2/Script1740576074455.groovy

:path_TS1: Test%20Suites/TS1.ts

- link:{blobmainPrefix}/{path_KeywordLogger}[{path_KeywordLogger}]

- link:{blobmainPrefix}/{path_ReportBuilder}[{path_ReportBuilder}]

- link:{blobmainPrefix}/{path_ReportBuilderExtentImpl}[{path_ReportBuilderExtentImpl}]

- link:{blobmainPrefix}/{path_ReportBuildersLoader}[{path_ReportBuildersLoader}]

- link:{blobmainPrefix}/{path_config}[{path_config}]

- link:{blobmainPrefix}/{path_Listener}[{path_Listener}]

- link:{blobmainPrefix}/{path_TC1}[Test Cases/main/TC1]

- link:{blobmainPrefix}/{path_TC2}[Test Cases/main/TC2]

- link:{blobmainPrefix}/{path_TS1}[{path_TS1}]

I learned a lot out of the GitHub repository link:https://github.com/coty/extent-report-sample[extent-report-sample] by @coty.

=== How to run the demo

Just run the `Test Suites/TS1`

=== Final result

The `<projectDir>/Extent` directory will be newly created where the reports will be generated by Extent Reports that look like

image:{PagesURLPrefix}/images/Result.png[]

== Conclusion

I think that it is the best approach to modify the `com.kms.katalon.core.logging.KeywordLogger` class to transfer the log messages into Extent Reports. My fake `KeywordLogger` implementation proved my idea is possibly good. I am contented with this result.

However, I am aware that my work is just the start of long development efforts to accomplish integrating Extent Reports into Katalon to a satisfactory level. I just worked on a single keyword `WebUI.comment`. There are dozens of more keywords to work on: `WebUI.click`, `WebUI.setText`, `WebUI.openBrowser`, `WebUI.verifyElementPresent`, and so on. We would need to amend the `KeywordLogger` class more significantly.

Who can achieve this task? --- Only Katalon can do it, as the `KeywordLogger` is their own property. Nobody else can.
